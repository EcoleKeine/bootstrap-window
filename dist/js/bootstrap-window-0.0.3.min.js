/*! bootstrap-window 2013-10-28 */
var Window=function(a){var b=this;a=a||{},b.title=a.title||"No Title",b.bodyContent=a.bodyContent||"",b.footerContent=a.footerContent||"";var c=function(){if(!b.options.template)throw new Error("No template specified for window.");b.$el=$(b.options.template),b.$el.find(".window-title").html(b.title),b.$el.find(".window-body").html(b.bodyContent),b.$el.find(".window-footer").html(b.footerContent),b.$el.hide(),b.$el.appendTo("body"),b.options.sticky?(b.$el.css("left",$(window).width()/2-b.$el.width()/2),b.$el.css("top",$(window).height()/2-b.$el.height()/2)):(b.$el.css("left",$(window).width()/2-b.$el.width()/2),b.$el.css("top",$(window).height()/2-b.$el.height()/2)),m(),b.$el.show(),b.id=b.options.id?b.options.id:"",k(b.options.sticky)},d=function(){b.$el.trigger("close"),b.$el.remove(),b.$windowTab&&b.$windowTab.remove()},e=function(a){a?(b.$el.addClass("active"),b.$windowTab&&b.$windowTab.addClass("label-primary")):(b.$el.removeClass("active"),b.$windowTab&&(b.$windowTab.removeClass("label-primary"),b.$windowTab.addClass("label-default")))},f=function(a){b.$el.css("zIndex",a)},g=function(a){b.$windowTab=a},h=function(){return b.$windowTab},i=function(){return b.title},j=function(){return b.$el},k=function(a){b.sticky=a,a===!1?b.$el.css({position:"absolute"}):b.$el.css({position:"fixed"})},l=function(){return b.sticky},m=function(){b.$el.find("[data-dismiss=window]").on("click",function(){d()}),b.$el.off("mousedown"),b.$el.on("mousedown",function(){b.$el.trigger("focused")}),b.$el.find(".window-header").off("mousedown"),b.$el.find(".window-header").on("mousedown",function(a){b.moving=!0,b.offset={},b.offset.x=a.pageX-b.$el.position().left,b.offset.y=a.pageY-b.$el.position().top,$("body > *").addClass("disable-select")}),b.$el.find(".window-header").on("mouseup",function(){b.moving=!1,$("body > *").removeClass("disable-select")}),$("body").on("mousemove",function(a){b.moving&&(b.$el.find(".window-header").position().top,b.$el.find(".window-header").position().left,b.$el.css("top",a.pageY-b.offset.y),b.$el.css("left",a.pageX-b.offset.x))})};return this.options=a,c(),Object.create({setActive:e,setIndex:f,getWindowTab:h,setWindowTab:g,getTitle:i,getElement:j,setSticky:k,getSticky:l,close:d})},WindowManager=function(a){this.windows=[];var b=this;a=a||{};var c=function(a){var c=null;return $.each(b.windows,function(b,d){console.log(arguments),d.id===a&&(c=d)}),c},d=function(a){$.each(b.windows,function(c,d){d===a&&(b.windows.splice(c,1),e())})},e=function(){var a=900;$.each(b.windows,function(b,c){c.setIndex(a+b)})},f=function(a){var c;$.each(b.windows,function(b,d){d.setActive(!1),d===a&&(c=b)}),b.windows.push(b.windows.splice(c,1)[0]),e(),a.setActive(!0)},g=function(){b.options=a,b.options.container&&$(b.options.container).addClass("window-pane")},h=function(c){var e=Object.create(c);a.windowTemplate&&!e.template&&(e.template=b.options.windowTemplate);var g=new Window(e);return g.getElement().on("focused",function(){f(g)}),g.getElement().on("close",function(){d(g),g.getWindowTab()&&g.getWindowTab().remove()}),b.options.container&&(g.setWindowTab($('<span class="label label-default">'+g.getTitle()+'<button class="close">x</button></span>')),g.getWindowTab().find(".close").on("click",function(){g.close()}),g.getWindowTab().on("click",function(){f(g),g.getSticky()&&window.scrollTo(0,g.getElement().position().top)}),$(a.container).append(g.getWindowTab())),b.windows.push(g),f(g),g};return g(),{setFocused:f,createWindow:h,resortWindows:e,findWindowByID:c}};